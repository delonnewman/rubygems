# Rakefile for RubyGems      -*- ruby -*-

require 'rubygems'
require 'rake/clean'
require 'rake/testtask'
require 'rake/packagetask'

PKG_NAME = 'rubygems'
PKG_VERSION = '0.4.0'

CLOBBER.include( "testdata/one/one-0.0.1.gem", "test/temp" )

task :default => [:test]

desc "Run unit tests"
task :test do
  ruby %{-Ilib -rscripts/runtest -e 'run_tests("test/test*.rb", true)'}
end

desc "Run Functional Tests"
task :functional do
  ruby %{-Ilib -rscripts/runtest -e 'run_tests("test/functional.rb", true)'}
end

desc "Run All Tests"
task :alltests do
  ruby %{-Ilib -rscripts/runtest -e 'run_tests("test/{test,functional}*.rb", true)'}
end


# Shortcuts for test targets
task :ft => [:functional]
task :ut => [:test]
task :at => [:alltests]

task :gemtest do
  ruby %{-Ilib -rscripts/runtest -e 'run_tests("test/test_gempaths.rb", true)'}
end

Rake::PackageTask.new("package") do |p|
  p.name = PKG_NAME
  p.version = PKG_VERSION
  p.need_tar = true
  p.need_zip = true
  p.package_files.include(
    "Rakefile", "ChangeLog", "Releases", "TODO", "README", 
    "install.rb",
    "bin/gem*", "bin/*.rb",
    "doc/*.css", "doc/*.rb",
    "examples/**/*",
    "gemspecs/**/*",
    "lib/**/*.rb",
    "packages/**/*",
    "redist/*.gem",
    "scripts/*.rb",
    "test/**/*"
    )
end
